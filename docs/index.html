<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>NAS Display</title>
  <link rel="stylesheet" href="MPPT.css">
</head>

<body>
  <h1>Arduino Based NAS Display</h1>

  <a href="https://github.com/atmelino/NASDisplay">https://github.com/atmelino/NASDisplay</a><br>
  <br>

  <h2>Hardware Components</h2>
  - Arduino UNO<br>
  - LCD shield<br>
  - USB B to A cable or USB B to motherboard USB 2 connector<br>
  - A server with a free USB-2 connector on the motherboard<br>

  <img src="LCD_shield.png" alt="LCD_shield" height="250">

  <a href="https://wiki.dfrobot.com/LCD_KeyPad_Shield_For_Arduino_SKU__DFR0009">
    https://wiki.dfrobot.com/LCD_KeyPad_Shield_For_Arduino_SKU__DFR0009</a><br>
  <br>


  <h2>Arduino Software</h2>

  Upload the NASDisplay.ino file to the Arduino.<br>
  The version on github works with a GPIO pin based LCD display (not the I2C version):
  <code>
    LiquidCrystal lcd(8, 9, 4, 5, 6, 7); // select the pins used on the LCD panel
  </code>


  Is the Arduino connected?<br>
  <code>
  lsusb
  </code>
  Output:
  <code>
   Bus 001 Device 002: ID 2341:0001 Arduino SA Uno (CDC ACM)
  </code>
  <br>
  Permission denied: '/dev/ttyACM0'<br>
  <code>
    sudo usermod -a -G dialout [your_username]
  </code>
  log out and log back in<br>
  actually, only worked after reboot<br>
  <br>
  Test communication with Arduino<br>
  <code>
  sudo apt-get install minicom
  </code>

  <code>
  minicom -D /dev/ttyACM0
  </code>

  Press CTRL-A Z<br>
  Press P<br>
  Press C for 9600 baud<br>
  <br>



  <h2>Server Software</h2>

  The server software consists of a python script that communicates with the Arduino.<br>

  <h4>Software Versions</h4>
  The 2019 version of the python software was using the PySensors packages.<br>
  This package no longer works with modern python versions.<br>
  <br>
  The 2025 version of the python software uses the psutil package which also provides CPU temperature.<br>



  <h4>Software Development as non-admin</h4>

  Download python script onto your server<br>
  <code>cd ~</code>
  <code>mkdir github</code>
  <code>cd github</code>
  <code>git clone https://github.com/atmelino/NASDisplay.git</code>
  <br>

  Install lm-sensors to get access to hardware sensors
  <code>sudo apt-get install lm-sensors</code>

  Install required python libraries<br>
  <code>pip install pyserial</code>
  <code>pip install psutil</code>
  <br>
  To run the python script:<br>
  <code>python3 NASDisplay.py</code>

  <h4>Software Development as root</h4>

  Since we want to be able to shut down the computer with a python
  script, we need to run the service as root.<br>
  <br>
  Login as root user<br>
  <code>sudo -i</code>

  If we try to run the script now, we will get an error that the psutil library is missing.<br>
  That is because we installed it as a non-admin user, and the root user can't see it.<br>
  <br>
  The serial and sensor packages need to be installed such that they
  are available to root.<br>
  <br>
  <code>sudo su<br>
      cd ~<br>
      umask 022<br>
      apt-get install python3-psutil
      </code>
  <br>
  <a href="https://stackoverflow.com/questions/36898474/how-to-install-a-module-for-all-users-with-pip-on-linux">
    https://stackoverflow.com/questions/36898474/how-to-install-a-module-for-all-users-with-pip-on-linux</a><br>
  <br>


  <h4> Autostart Display script at Boot</h4>
  Since we want the script to start automatically when the server starts, we will use the systemd mechanism.<br>

  In the NASDisplay.service file, the lines will be<br>
  <br>
  <code>
    [Service]<br>
    User=root<br>
  </code>
  <br>
  Copy the NASDisplay.service file to /etc/systemd/system/:
  <code>/etc/systemd/system/NASDisplay.service</code>

  <a href="https://github.com/atmelino/NASDisplay/blob/master/systemd/NASDisplay.service">
    https://github.com/atmelino/NASDisplay/blob/master/systemd/NASDisplay.service
  </a><br>
  Modify as needed (for example, user name and path of python script)<br>
  <br>

  add the NASDisplay software as a service using systemd.<br>
  add file NASDisplay.service to /etc/systemd/system.<br>
  Start the service:<br>
  <code>sudo systemctl start NASDisplay.service</code><br>
  Check the status:<br>
  <code>sudo systemctl status NASDisplay.service</code><br>
  If there is an error, check the journal:<br>
  To see output from service:<br>
  <code>journalctl -u NASDisplay.service -b</code><br>

  If there was an error, it might be that the psutil library is missing.<br>

  In that case, go back to the terminal and try to run the script as root.<br>
  <code>ModuleNotFoundError: No module named 'psutil'</code>
  <br>


  When it works:<br>
  To start automatically at boot:<br>
  <code>sudo systemctl enable NASDisplay.service</code><br>





  <h4>Useful commands</h4>

  Start the service:<br>
  <code>sudo systemctl start NASDisplay.service</code><br>
  Stop the service:<br>
  <code>sudo systemctl stop NASDisplay.service</code><br>
  check status:<br>
  <code>sudo systemctl status NASDisplay.service</code><br>
  during development<br>
  <code>sudo systemctl daemon-reload</code><br>
  <code>sudo systemctl restart NASDisplay.service</code><br>
  To start automatically at boot:<br>
  <code>sudo systemctl enable NASDisplay.service</code><br>
  To list all services:<br>
  <code>sudo systemctl list-unit-files</code><br>
  or<br>
  <code>sudo systemctl list-unit-files | grep NASDisplay.service </code><br>
  To see output from service:<br>
  <code>journalctl -u NASDisplay.service -b</code><br>
  To shorten journal file:<br>
  <code>sudo journalctl --rotate</code><br>
  <code>sudo journalctl --vacuum-time=1s</code><br>
  <br>

  ----------------------------------------------<br>
  old<br>
  <code>pip install pyserial</code>
  <code>pip install PySensors</code>

  modemmanager causes problems by probing serial ports<br>
  remove modemmanager:<br>
  <br>
  <code>sudo apt-get purge modemmanager</code> <br>
  <a
    href="https://askubuntu.com/questions/216114/how-can-i-remove-modem-manager-from-boot">https://askubuntu.com/questions/216114/how-can-i-remove-modem-manager-from-boot</a><br>
  <br>

  <a href=""></a><br>


</body>

</html>